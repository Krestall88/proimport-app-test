Технический стек
Фреймворк: Next.js (React) для создания серверного и клиентского рендеринга, с поддержкой Vercel.
База данных: Supabase (на основе PostgreSQL) для хранения данных и управления аутентификацией.
Автоматизация: n8n для отправки уведомлений, интеграции с внешними сервисами и автоматизации процессов.
Развертывание: GitHub для управления кодом, Vercel для хостинга и CI/CD.
Разработка: Windsur с встроенным ИИ для генерации кода и интерфейсов.
Стилизация: Tailwind CSS для адаптивного дизайна, включая мобильную версию.
Аутентификация: Supabase Auth для управления ролями и доступом.
API: Next.js API Routes для серверной логики.
Уведомления: n8n для отправки email (через SMTP-провайдер, например, SendGrid) и push-уведомлений (через Firebase Cloud Messaging, интегрированный с Supabase).
Интеграции: Google Maps API для автодополнения адресов, Supabase для интеграции с 1С (через API).
Требования к развертыванию на Vercel
Код должен быть оптимизирован для Vercel: использование Next.js API Routes, статической генерации (SSG) и серверного рендеринга (SSR) для оптимизации производительности.
Поддержка переменных окружения через Vercel Dashboard для хранения ключей API (Supabase, SendGrid, Google Maps, FCM).
Автоматическое развертывание через GitHub с использованием Vercel CLI.
Адаптивный дизайн с Tailwind CSS для корректной работы на мобильных устройствах.
Отсутствие <form> с атрибутом onSubmit из-за ограничений песочницы Vercel (использовать JavaScript для обработки форм).
Функциональные требования
Заказ продукции на заводе
Функциональность:
Создание заказа:
Только владелец (роль owner) имеет доступ к разделу заказов через веб-интерфейс.
Форма включает поля:
Название и характеристики товара (текст, артикул, тип упаковки).
Количество (число, проверка на положительное значение).
Ожидаемая дата поставки (выбор даты, только будущие даты).
Поставщик (выпадающий список с возможностью добавления нового: имя, контакт, комментарий).
Комментарии (textarea для условий поставки, транспорта и т.д.).
Проверка формы: все обязательные поля заполнены, данные валидны.
После отправки заказ сохраняется в базе с уникальным ID и статусом "Pending".
Уведомление:
Заведующий складом (роль warehouse_manager) получает уведомление о новом заказе с деталями и сроками поставки.
Уведомление отправляется через email и push в веб-приложении.
Реализация:
Frontend: Компонент React с Tailwind CSS, форма с валидацией через React Hook Form.
Backend: API Route (POST /api/orders) сохраняет заказ в таблицу orders в Supabase.
База данных: Таблица orders:
Поля: id (uuid), product_name (text), characteristics (jsonb), quantity (integer), expected_delivery_date (date), supplier_id (uuid, ссылка на таблицу suppliers), comments (text), status (text), created_by (uuid, ссылка на users), created_at (timestamp).
Уведомления: n8n запускает воркфлоу:
Получает данные заказа через Supabase Webhook.
Отправляет email через SendGrid (SMTP) и push через FCM для роли warehouse_manager.
________________________________________
Приём товара на складе
Функциональность:
Ввод данных о приёме:
Заведующий складом (роль warehouse_manager) видит список ожидаемых заказов в веб-интерфейсе.
Выбирает заказ и заполняет форму:
Номенклатура (артикул, описание, сопоставляется с заказом).
Фактически полученное количество (число).
Характеристики (тип упаковки, номер партии).
Комментарии (textarea для брака, недостачи, просрочки).
Система сравнивает введённые данные с заказом (артикул, количество, характеристики).
При расхождениях блокирует отправку до корректировки или добавления комментария.
После отправки статус заказа обновляется: "Received" или "Partially Received".
Уведомление владельца:
Владелец (роль owner) получает уведомление с информацией о приёме, расхождениях и комментариях.
Реализация:
Frontend: React-компонент с таблицей заказов и модальной формой, валидация через React Hook Form.
Backend: API Routes (GET /api/orders/pending, POST /api/orders/receive) для получения заказов и сохранения данных приёма.
База данных:
Таблица receipts:
Поля: id (uuid), order_id (uuid), sku (text), quantity_received (integer), characteristics (jsonb), comments (text), status (text), created_at (timestamp).
Логика проверки: сравнение таблиц orders и receipts на сервере.
Уведомления: n8n воркфлоу:
Webhook от Supabase при создании записи в receipts.
Отправка email (SendGrid) и push (FCM) для роли owner.
________________________________________
Работа агентов
Управление базой заказчиков
Функциональность:
Создание заказчика:
Агент (роль agent) через веб-интерфейс добавляет нового заказчика:
Поля: название, ИНН, КПП, банковские реквизиты (текст), контактные лица (массив: имя, телефон, email), адрес доставки (автодополнение через Google Maps API), условия оплаты (выпадающий список), комментарии.
Данные сохраняются с уникальным ID.
Выбор заказчика:
Агент выбирает заказчика из списка (поиск по имени или ИНН).
Реализация:
Frontend: React-форма с Tailwind CSS, автодополнение адресов через Google Maps API, поиск через React-Select.
Backend: API Routes (POST /api/customers, GET /api/customers) для создания и получения данных.
База данных: Таблица customers:
Поля: id (uuid), name (text), tin (text), kpp (text), bank_details (jsonb), contacts (jsonb), delivery_address (text), payment_terms (text), comments (text), created_at (timestamp).
Управление остатками и заказами
Функциональность:
Просмотр остатков:
Агент видит в интерфейсе:
Список товаров: артикул, название, количество, статус (в наличии, заканчивается, отсутствует, в пути).
Срок годности с уведомлениями о скором истечении (<30 дней).
Фильтры по статусу и сроку годности.
Создание заказа:
Агент выбирает заказчика, добавляет товары (выпадающий список, проверка остатков), указывает количество.
Возможность приоритизации клиентов (например, флаг "приоритет" в заказе).
После отправки заказ сохраняется со статусом "Pending", обновляются остатки.
Реализация:
Frontend: React-таблица для остатков, форма для заказа, обновление в реальном времени через Supabase Realtime.
Backend: API Routes (GET /api/inventory, POST /api/customer-orders) для получения остатков и создания заказов.
База данных:
Таблица inventory: id (uuid), sku (text), name (text), quantity (integer), status (text), expiry_date (date).
Таблица customer_orders: id (uuid), customer_id (uuid), products (jsonb), quantity (integer), status (text), priority (boolean), created_at (timestamp).
Уведомления: n8n отправляет push-уведомления агенту при истечении срока годности (ежедневный воркфлоу).
________________________________________
Подготовка и отгрузка заказов
Функциональность:
Подготовка заказа:
Заведующий складом (роль warehouse_manager) получает уведомление о новом заказе клиента.
В интерфейсе видит заказ, собирает товары и отмечает статус "Collected".
Система формирует накладную (PDF, 2 экземпляра) и отправляет на печать.
Уведомление:     
Водитель (роль driver) получает уведомление о готовом заказе с адресом доставки.
Реализация:
Frontend: React-компонент для списка заказов, кнопка для смены статуса, просмотр PDF.
Backend: API Route (POST /api/customer-orders/collect) для обновления статуса, генерация PDF через pdfkit.
База данных: Обновление customer_orders (status = "Collected").
Уведомления: n8n отправляет push (FCM) водителю с деталями заказа.
________________________________________
Работа водителя
Функциональность:
Получение задания:
Водитель (роль driver) видит в мобильно-адаптированном интерфейсе маршрут, накладную и адрес доставки.
Подтверждение доставки:
После доставки водитель отмечает статус "Delivered", загружает фото подписанной накладной.
Отправка подтверждает завершение доставки.
Уведомление:
Агент, заведующий складом и бухгалтер получают уведомление о доставке.
Реализация:
Frontend: Мобильно-адаптированный React-компонент с Tailwind CSS (responsive breakpoints), загрузка фото через Supabase Storage.
Backend: API Route (POST /api/customer-orders/deliver) для обновления статуса и сохранения фото.
База данных:
Таблица deliveries: id (uuid), order_id (uuid), photo_url (text), status (text), created_at (timestamp).
Уведомления: n8n отправляет email (SendGrid) и push (FCM) ролям agent, warehouse_manager, accountant.
________________________________________
Работа бухгалтера
Формирование счёта-фактуры
Функциональность:
Бухгалтер (роль accountant) видит подтверждённые заказы.
Нажимает кнопку для создания счёта-фактуры (PDF, автозаполнение из заказа).
Счёт-фактура отправляется заказчику по email.
Реализация:
Frontend: React-компонент с таблицей заказов, кнопка для генерации PDF.
Backend: API Route (POST /api/invoices) для создания PDF через pdfkit.
Уведомления: n8n отправляет email с PDF через SendGrid.
Отслеживание оплаты
Функциональность:
Система отсчитывает 3 дня на оплату (настраиваемый срок).
Бухгалтер видит статус: "Paid", "Pending", "Overdue".
При просрочке:
Бухгалтер получает уведомление.
Вносит причину задержки и действия (звонок, письмо) в карточку заказа.
Владелец видит статус оплаты и действия.
Реализация:
Frontend: React-таблица с фильтрами по статусу, форма для комментариев.
Backend: API Route (POST /api/payments) для обновления статуса и комментариев.
База данных: Таблица payments: id (uuid), order_id (uuid), status (text), due_date (date), comments (text).
Уведомления: n8n воркфлоу для проверки сроков (ежедневно) и отправки уведомлений (SendGrid, FCM).
Интеграция с 1С
Функциональность:
Данные заказов, счетов-фактур и оплат автоматически передаются в 1С через API.
Реализация:
Backend: API Route (POST /api/1c-sync) отправляет данные в 1С через HTTP-запрос.
Автоматизация: n8n воркфлоу для периодической синхронизации.
________________________________________
Аналитика и контроль
Доступ владельца
Функциональность:
Владелец (роль owner) имеет полный доступ ко всем разделам.
Получает уведомления о:
Поступлении товаров.
Проблемах с приёмкой.
Заканчивающихся товарах.
Истекающих сроках годности.
Неоплаченных заказах.
Отчётах по продажам.
Реализация:
Frontend: React-дашборд с виджетами (графики, уведомления).
Backend: API Routes для получения данных аналитики.
Уведомления: n8n отправляет уведомления через SendGrid и FCM.
Отчётность
Функциональность:
Отчёты по:
Продажам агентов.
Динамике остатков.
Движению по складу.
Прибыли, расходам, логистике, зарплатам.
Себестоимости и наценке.
Доступ к финансовому отчёту в любое время.
Реализация:
Frontend: React-компоненты с графиками (Chart.js).
Backend: API Route (GET /api/reports) для агрегации данных из таблиц orders, customer_orders, payments, inventory.
База данных: Использование Supabase SQL-запросов для аналитики.
________________________________________
Безопасность и контроль действий
Функциональность:
Роли и доступ:
Роли: owner, warehouse_manager, agent, driver, accountant.
Каждый пользователь имеет логин и доступ по роли через Supabase Auth.
Лог действий:
Логируются все действия: кто, когда, что сделал.
Владелец может просматривать логи.
Реализация:
Аутентификация: Supabase Auth с JWT-токенами, настройка RLS (Row Level Security) для ограничения доступа.
Логи: Таблица action_logs: id (uuid), user_id (uuid), action (text), details (jsonb), created_at (timestamp).
Frontend: React-компонент для просмотра логов (только для owner).
Backend: API Route (GET /api/logs) для получения логов.
________________________________________
Система уведомлений
Инструменты:
Email: SendGrid через n8n для отправки писем (настройка SMTP в Vercel Environment Variables).
Push-уведомления: Firebase Cloud Messaging, интегрированный с Supabase Realtime.
Воркфлоу n8n:
Webhook от Supabase при создании/обновлении записей в таблицах (orders, receipts, customer_orders, deliveries, payments).
Отправка email для ролей owner, warehouse_manager, accountant, agent.
Отправка push-уведомлений для ролей warehouse_manager, agent, driver, accountant.
Ежедневный воркфлоу для проверки сроков годности и оплаты.
Мобильная адаптация:
Push-уведомления отображаются на мобильных устройствах через браузер (поддержка PWA в Next.js).